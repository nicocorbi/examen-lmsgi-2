<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Vino</title>
</head>
<body>
    <h1>Detalle del Vino</h1>

    <div id="vino-info">
        <h2 id="vino-nombre"></h2>
        <p id="vino-año"></p>
        <p id="vino-tipo"></p>
        <p id="vino-precio"></p>
        <p id="vino-stock"></p>
        <img id="vino-imagen" src="" alt="Imagen del vino" width="200">
    </div>

    <h2>Catas</h2>
    <ul id="lista-catas"></ul>

    <script>
        // Obtener el id del vino de la URL (asumimos que está en el formato /vino.html?id=1)
        const urlParams = new URLSearchParams(window.location.search);
        const vinoId = urlParams.get('id'); // Obtener el id del vino

        // URL de la API
        const vinoUrl = `http://localhost:3000/vinos/${vinoId}`;
        const cataUrl = `http://localhost:3000/cata`;

        // Función para obtener los detalles del vino
        fetch(vinoUrl)
            .then(response => response.json())
            .then(vino => {
                // Mostrar la información del vino en la página
                document.getElementById('vino-nombre').textContent = vino.nombre;
                document.getElementById('vino-año').textContent = `Año: ${vino.anio}`;
                document.getElementById('vino-tipo').textContent = `Tipo: ${vino.tipo}`;
                document.getElementById('vino-precio').textContent = `Precio: $${vino.precio}`;
                document.getElementById('vino-stock').textContent = `Stock: ${vino.stock}`;
                document.getElementById('vino-imagen').src = vino.imagen;

                // Ahora obtenemos las catas asociadas a este vino
                fetch(cataUrl)
                    .then(response => response.json())
                    .then(catas => {
                        // Filtrar las catas para obtener solo las que corresponden a este vino
                        const catasVino = catas.filter(cata => cata.id_vino == vino.id);
                        
                        // Mostrar las catas en la lista
                        const listaCatas = document.getElementById('lista-catas');
                        catasVino.forEach(cata => {
                            const item = document.createElement('li');
                            item.textContent = `Nota: ${cata.nota} - Comentario: ${cata.comentario}`;
                            listaCatas.appendChild(item);
                        });
                    })
                    .catch(error => {
                        console.error('Error al obtener las catas:', error);
                    });
            })
            .catch(error => {
                console.error('Error al obtener el vino:', error);
            });
    </script>
</body>
</html>
